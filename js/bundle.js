!function(t){var e={};function n(r){if(e[r])return e[r].exports;var a=e[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(r,a,function(e){return t[e]}.bind(null,a));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=5)}({5:function(t,e,n){"use strict";n.r(e),n.d(e,"GL",(function(){return Vn})),n.d(e,"loadScene",(function(){return dr}));var r={};n.r(r),n.d(r,"create",(function(){return d})),n.d(r,"clone",(function(){return h})),n.d(r,"copy",(function(){return f})),n.d(r,"fromValues",(function(){return l})),n.d(r,"set",(function(){return m})),n.d(r,"identity",(function(){return M})),n.d(r,"transpose",(function(){return T})),n.d(r,"invert",(function(){return p})),n.d(r,"adjoint",(function(){return v})),n.d(r,"determinant",(function(){return g})),n.d(r,"multiply",(function(){return b})),n.d(r,"translate",(function(){return E})),n.d(r,"scale",(function(){return x})),n.d(r,"rotate",(function(){return w})),n.d(r,"rotateX",(function(){return R})),n.d(r,"rotateY",(function(){return y})),n.d(r,"rotateZ",(function(){return S})),n.d(r,"fromTranslation",(function(){return D})),n.d(r,"fromScaling",(function(){return P})),n.d(r,"fromRotation",(function(){return F})),n.d(r,"fromXRotation",(function(){return A})),n.d(r,"fromYRotation",(function(){return U})),n.d(r,"fromZRotation",(function(){return I})),n.d(r,"fromRotationTranslation",(function(){return L})),n.d(r,"fromQuat2",(function(){return _})),n.d(r,"getTranslation",(function(){return O})),n.d(r,"getScaling",(function(){return B})),n.d(r,"getRotation",(function(){return N})),n.d(r,"fromRotationTranslationScale",(function(){return C})),n.d(r,"fromRotationTranslationScaleOrigin",(function(){return X})),n.d(r,"fromQuat",(function(){return q})),n.d(r,"frustum",(function(){return G})),n.d(r,"perspective",(function(){return k})),n.d(r,"perspectiveFromFieldOfView",(function(){return z})),n.d(r,"ortho",(function(){return V})),n.d(r,"lookAt",(function(){return $})),n.d(r,"targetTo",(function(){return H})),n.d(r,"str",(function(){return j})),n.d(r,"frob",(function(){return Y})),n.d(r,"add",(function(){return W})),n.d(r,"subtract",(function(){return K})),n.d(r,"multiplyScalar",(function(){return Z})),n.d(r,"multiplyScalarAndAdd",(function(){return Q})),n.d(r,"exactEquals",(function(){return J})),n.d(r,"equals",(function(){return tt})),n.d(r,"mul",(function(){return et})),n.d(r,"sub",(function(){return nt}));var a={};n.r(a),n.d(a,"create",(function(){return rt})),n.d(a,"clone",(function(){return at})),n.d(a,"fromValues",(function(){return ot})),n.d(a,"copy",(function(){return it})),n.d(a,"set",(function(){return st})),n.d(a,"add",(function(){return ut})),n.d(a,"subtract",(function(){return ct})),n.d(a,"multiply",(function(){return dt})),n.d(a,"divide",(function(){return ht})),n.d(a,"ceil",(function(){return ft})),n.d(a,"floor",(function(){return lt})),n.d(a,"min",(function(){return mt})),n.d(a,"max",(function(){return Mt})),n.d(a,"round",(function(){return Tt})),n.d(a,"scale",(function(){return pt})),n.d(a,"scaleAndAdd",(function(){return vt})),n.d(a,"distance",(function(){return gt})),n.d(a,"squaredDistance",(function(){return bt})),n.d(a,"length",(function(){return Et})),n.d(a,"squaredLength",(function(){return xt})),n.d(a,"negate",(function(){return wt})),n.d(a,"inverse",(function(){return Rt})),n.d(a,"normalize",(function(){return yt})),n.d(a,"dot",(function(){return St})),n.d(a,"cross",(function(){return Dt})),n.d(a,"lerp",(function(){return Pt})),n.d(a,"random",(function(){return Ft})),n.d(a,"transformMat2",(function(){return At})),n.d(a,"transformMat2d",(function(){return Ut})),n.d(a,"transformMat3",(function(){return It})),n.d(a,"transformMat4",(function(){return Lt})),n.d(a,"rotate",(function(){return _t})),n.d(a,"angle",(function(){return Ot})),n.d(a,"zero",(function(){return Bt})),n.d(a,"str",(function(){return Nt})),n.d(a,"exactEquals",(function(){return Ct})),n.d(a,"equals",(function(){return Xt})),n.d(a,"len",(function(){return Gt})),n.d(a,"sub",(function(){return kt})),n.d(a,"mul",(function(){return zt})),n.d(a,"div",(function(){return Vt})),n.d(a,"dist",(function(){return $t})),n.d(a,"sqrDist",(function(){return Ht})),n.d(a,"sqrLen",(function(){return jt})),n.d(a,"forEach",(function(){return Yt}));var o={};n.r(o),n.d(o,"create",(function(){return Wt})),n.d(o,"clone",(function(){return Kt})),n.d(o,"length",(function(){return Zt})),n.d(o,"fromValues",(function(){return Qt})),n.d(o,"copy",(function(){return Jt})),n.d(o,"set",(function(){return te})),n.d(o,"add",(function(){return ee})),n.d(o,"subtract",(function(){return ne})),n.d(o,"multiply",(function(){return re})),n.d(o,"divide",(function(){return ae})),n.d(o,"ceil",(function(){return oe})),n.d(o,"floor",(function(){return ie})),n.d(o,"min",(function(){return se})),n.d(o,"max",(function(){return ue})),n.d(o,"round",(function(){return ce})),n.d(o,"scale",(function(){return de})),n.d(o,"scaleAndAdd",(function(){return he})),n.d(o,"distance",(function(){return fe})),n.d(o,"squaredDistance",(function(){return le})),n.d(o,"squaredLength",(function(){return me})),n.d(o,"negate",(function(){return Me})),n.d(o,"inverse",(function(){return Te})),n.d(o,"normalize",(function(){return pe})),n.d(o,"dot",(function(){return ve})),n.d(o,"cross",(function(){return ge})),n.d(o,"lerp",(function(){return be})),n.d(o,"hermite",(function(){return Ee})),n.d(o,"bezier",(function(){return xe})),n.d(o,"random",(function(){return we})),n.d(o,"transformMat4",(function(){return Re})),n.d(o,"transformMat3",(function(){return ye})),n.d(o,"transformQuat",(function(){return Se})),n.d(o,"rotateX",(function(){return De})),n.d(o,"rotateY",(function(){return Pe})),n.d(o,"rotateZ",(function(){return Fe})),n.d(o,"angle",(function(){return Ae})),n.d(o,"zero",(function(){return Ue})),n.d(o,"str",(function(){return Ie})),n.d(o,"exactEquals",(function(){return Le})),n.d(o,"equals",(function(){return _e})),n.d(o,"sub",(function(){return Oe})),n.d(o,"mul",(function(){return Be})),n.d(o,"div",(function(){return Ne})),n.d(o,"dist",(function(){return Ce})),n.d(o,"sqrDist",(function(){return Xe})),n.d(o,"len",(function(){return qe})),n.d(o,"sqrLen",(function(){return Ge})),n.d(o,"forEach",(function(){return ke}));var i={};n.r(i),n.d(i,"create",(function(){return ze})),n.d(i,"clone",(function(){return Ve})),n.d(i,"fromValues",(function(){return $e})),n.d(i,"copy",(function(){return He})),n.d(i,"set",(function(){return je})),n.d(i,"add",(function(){return Ye})),n.d(i,"subtract",(function(){return We})),n.d(i,"multiply",(function(){return Ke})),n.d(i,"divide",(function(){return Ze})),n.d(i,"ceil",(function(){return Qe})),n.d(i,"floor",(function(){return Je})),n.d(i,"min",(function(){return tn})),n.d(i,"max",(function(){return en})),n.d(i,"round",(function(){return nn})),n.d(i,"scale",(function(){return rn})),n.d(i,"scaleAndAdd",(function(){return an})),n.d(i,"distance",(function(){return on})),n.d(i,"squaredDistance",(function(){return sn})),n.d(i,"length",(function(){return un})),n.d(i,"squaredLength",(function(){return cn})),n.d(i,"negate",(function(){return dn})),n.d(i,"inverse",(function(){return hn})),n.d(i,"normalize",(function(){return fn})),n.d(i,"dot",(function(){return ln})),n.d(i,"cross",(function(){return mn})),n.d(i,"lerp",(function(){return Mn})),n.d(i,"random",(function(){return Tn})),n.d(i,"transformMat4",(function(){return pn})),n.d(i,"transformQuat",(function(){return vn})),n.d(i,"zero",(function(){return gn})),n.d(i,"str",(function(){return bn})),n.d(i,"exactEquals",(function(){return En})),n.d(i,"equals",(function(){return xn})),n.d(i,"sub",(function(){return wn})),n.d(i,"mul",(function(){return Rn})),n.d(i,"div",(function(){return yn})),n.d(i,"dist",(function(){return Sn})),n.d(i,"sqrDist",(function(){return Dn})),n.d(i,"len",(function(){return Pn})),n.d(i,"sqrLen",(function(){return Fn})),n.d(i,"forEach",(function(){return An}));var s=1e-6,u="undefined"!=typeof Float32Array?Float32Array:Array,c=Math.random;Math.PI;function d(){var t=new u(16);return u!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function h(t){var e=new u(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function f(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function l(t,e,n,r,a,o,i,s,c,d,h,f,l,m,M,T){var p=new u(16);return p[0]=t,p[1]=e,p[2]=n,p[3]=r,p[4]=a,p[5]=o,p[6]=i,p[7]=s,p[8]=c,p[9]=d,p[10]=h,p[11]=f,p[12]=l,p[13]=m,p[14]=M,p[15]=T,p}function m(t,e,n,r,a,o,i,s,u,c,d,h,f,l,m,M,T){return t[0]=e,t[1]=n,t[2]=r,t[3]=a,t[4]=o,t[5]=i,t[6]=s,t[7]=u,t[8]=c,t[9]=d,t[10]=h,t[11]=f,t[12]=l,t[13]=m,t[14]=M,t[15]=T,t}function M(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function T(t,e){if(t===e){var n=e[1],r=e[2],a=e[3],o=e[6],i=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=a,t[13]=i,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function p(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=e[4],s=e[5],u=e[6],c=e[7],d=e[8],h=e[9],f=e[10],l=e[11],m=e[12],M=e[13],T=e[14],p=e[15],v=n*s-r*i,g=n*u-a*i,b=n*c-o*i,E=r*u-a*s,x=r*c-o*s,w=a*c-o*u,R=d*M-h*m,y=d*T-f*m,S=d*p-l*m,D=h*T-f*M,P=h*p-l*M,F=f*p-l*T,A=v*F-g*P+b*D+E*S-x*y+w*R;return A?(A=1/A,t[0]=(s*F-u*P+c*D)*A,t[1]=(a*P-r*F-o*D)*A,t[2]=(M*w-T*x+p*E)*A,t[3]=(f*x-h*w-l*E)*A,t[4]=(u*S-i*F-c*y)*A,t[5]=(n*F-a*S+o*y)*A,t[6]=(T*b-m*w-p*g)*A,t[7]=(d*w-f*b+l*g)*A,t[8]=(i*P-s*S+c*R)*A,t[9]=(r*S-n*P-o*R)*A,t[10]=(m*x-M*b+p*v)*A,t[11]=(h*b-d*x-l*v)*A,t[12]=(s*y-i*D-u*R)*A,t[13]=(n*D-r*y+a*R)*A,t[14]=(M*g-m*E-T*v)*A,t[15]=(d*E-h*g+f*v)*A,t):null}function v(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=e[4],s=e[5],u=e[6],c=e[7],d=e[8],h=e[9],f=e[10],l=e[11],m=e[12],M=e[13],T=e[14],p=e[15];return t[0]=s*(f*p-l*T)-h*(u*p-c*T)+M*(u*l-c*f),t[1]=-(r*(f*p-l*T)-h*(a*p-o*T)+M*(a*l-o*f)),t[2]=r*(u*p-c*T)-s*(a*p-o*T)+M*(a*c-o*u),t[3]=-(r*(u*l-c*f)-s*(a*l-o*f)+h*(a*c-o*u)),t[4]=-(i*(f*p-l*T)-d*(u*p-c*T)+m*(u*l-c*f)),t[5]=n*(f*p-l*T)-d*(a*p-o*T)+m*(a*l-o*f),t[6]=-(n*(u*p-c*T)-i*(a*p-o*T)+m*(a*c-o*u)),t[7]=n*(u*l-c*f)-i*(a*l-o*f)+d*(a*c-o*u),t[8]=i*(h*p-l*M)-d*(s*p-c*M)+m*(s*l-c*h),t[9]=-(n*(h*p-l*M)-d*(r*p-o*M)+m*(r*l-o*h)),t[10]=n*(s*p-c*M)-i*(r*p-o*M)+m*(r*c-o*s),t[11]=-(n*(s*l-c*h)-i*(r*l-o*h)+d*(r*c-o*s)),t[12]=-(i*(h*T-f*M)-d*(s*T-u*M)+m*(s*f-u*h)),t[13]=n*(h*T-f*M)-d*(r*T-a*M)+m*(r*f-a*h),t[14]=-(n*(s*T-u*M)-i*(r*T-a*M)+m*(r*u-a*s)),t[15]=n*(s*f-u*h)-i*(r*f-a*h)+d*(r*u-a*s),t}function g(t){var e=t[0],n=t[1],r=t[2],a=t[3],o=t[4],i=t[5],s=t[6],u=t[7],c=t[8],d=t[9],h=t[10],f=t[11],l=t[12],m=t[13],M=t[14],T=t[15];return(e*i-n*o)*(h*T-f*M)-(e*s-r*o)*(d*T-f*m)+(e*u-a*o)*(d*M-h*m)+(n*s-r*i)*(c*T-f*l)-(n*u-a*i)*(c*M-h*l)+(r*u-a*s)*(c*m-d*l)}function b(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3],s=e[4],u=e[5],c=e[6],d=e[7],h=e[8],f=e[9],l=e[10],m=e[11],M=e[12],T=e[13],p=e[14],v=e[15],g=n[0],b=n[1],E=n[2],x=n[3];return t[0]=g*r+b*s+E*h+x*M,t[1]=g*a+b*u+E*f+x*T,t[2]=g*o+b*c+E*l+x*p,t[3]=g*i+b*d+E*m+x*v,g=n[4],b=n[5],E=n[6],x=n[7],t[4]=g*r+b*s+E*h+x*M,t[5]=g*a+b*u+E*f+x*T,t[6]=g*o+b*c+E*l+x*p,t[7]=g*i+b*d+E*m+x*v,g=n[8],b=n[9],E=n[10],x=n[11],t[8]=g*r+b*s+E*h+x*M,t[9]=g*a+b*u+E*f+x*T,t[10]=g*o+b*c+E*l+x*p,t[11]=g*i+b*d+E*m+x*v,g=n[12],b=n[13],E=n[14],x=n[15],t[12]=g*r+b*s+E*h+x*M,t[13]=g*a+b*u+E*f+x*T,t[14]=g*o+b*c+E*l+x*p,t[15]=g*i+b*d+E*m+x*v,t}function E(t,e,n){var r,a,o,i,s,u,c,d,h,f,l,m,M=n[0],T=n[1],p=n[2];return e===t?(t[12]=e[0]*M+e[4]*T+e[8]*p+e[12],t[13]=e[1]*M+e[5]*T+e[9]*p+e[13],t[14]=e[2]*M+e[6]*T+e[10]*p+e[14],t[15]=e[3]*M+e[7]*T+e[11]*p+e[15]):(r=e[0],a=e[1],o=e[2],i=e[3],s=e[4],u=e[5],c=e[6],d=e[7],h=e[8],f=e[9],l=e[10],m=e[11],t[0]=r,t[1]=a,t[2]=o,t[3]=i,t[4]=s,t[5]=u,t[6]=c,t[7]=d,t[8]=h,t[9]=f,t[10]=l,t[11]=m,t[12]=r*M+s*T+h*p+e[12],t[13]=a*M+u*T+f*p+e[13],t[14]=o*M+c*T+l*p+e[14],t[15]=i*M+d*T+m*p+e[15]),t}function x(t,e,n){var r=n[0],a=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function w(t,e,n,r){var a,o,i,u,c,d,h,f,l,m,M,T,p,v,g,b,E,x,w,R,y,S,D,P,F=r[0],A=r[1],U=r[2],I=Math.hypot(F,A,U);return I<s?null:(F*=I=1/I,A*=I,U*=I,a=Math.sin(n),i=1-(o=Math.cos(n)),u=e[0],c=e[1],d=e[2],h=e[3],f=e[4],l=e[5],m=e[6],M=e[7],T=e[8],p=e[9],v=e[10],g=e[11],b=F*F*i+o,E=A*F*i+U*a,x=U*F*i-A*a,w=F*A*i-U*a,R=A*A*i+o,y=U*A*i+F*a,S=F*U*i+A*a,D=A*U*i-F*a,P=U*U*i+o,t[0]=u*b+f*E+T*x,t[1]=c*b+l*E+p*x,t[2]=d*b+m*E+v*x,t[3]=h*b+M*E+g*x,t[4]=u*w+f*R+T*y,t[5]=c*w+l*R+p*y,t[6]=d*w+m*R+v*y,t[7]=h*w+M*R+g*y,t[8]=u*S+f*D+T*P,t[9]=c*S+l*D+p*P,t[10]=d*S+m*D+v*P,t[11]=h*S+M*D+g*P,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function R(t,e,n){var r=Math.sin(n),a=Math.cos(n),o=e[4],i=e[5],s=e[6],u=e[7],c=e[8],d=e[9],h=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*a+c*r,t[5]=i*a+d*r,t[6]=s*a+h*r,t[7]=u*a+f*r,t[8]=c*a-o*r,t[9]=d*a-i*r,t[10]=h*a-s*r,t[11]=f*a-u*r,t}function y(t,e,n){var r=Math.sin(n),a=Math.cos(n),o=e[0],i=e[1],s=e[2],u=e[3],c=e[8],d=e[9],h=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*a-c*r,t[1]=i*a-d*r,t[2]=s*a-h*r,t[3]=u*a-f*r,t[8]=o*r+c*a,t[9]=i*r+d*a,t[10]=s*r+h*a,t[11]=u*r+f*a,t}function S(t,e,n){var r=Math.sin(n),a=Math.cos(n),o=e[0],i=e[1],s=e[2],u=e[3],c=e[4],d=e[5],h=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*a+c*r,t[1]=i*a+d*r,t[2]=s*a+h*r,t[3]=u*a+f*r,t[4]=c*a-o*r,t[5]=d*a-i*r,t[6]=h*a-s*r,t[7]=f*a-u*r,t}function D(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function P(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function F(t,e,n){var r,a,o,i=n[0],u=n[1],c=n[2],d=Math.hypot(i,u,c);return d<s?null:(i*=d=1/d,u*=d,c*=d,r=Math.sin(e),o=1-(a=Math.cos(e)),t[0]=i*i*o+a,t[1]=u*i*o+c*r,t[2]=c*i*o-u*r,t[3]=0,t[4]=i*u*o-c*r,t[5]=u*u*o+a,t[6]=c*u*o+i*r,t[7]=0,t[8]=i*c*o+u*r,t[9]=u*c*o-i*r,t[10]=c*c*o+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function A(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function U(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function I(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function L(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3],s=r+r,u=a+a,c=o+o,d=r*s,h=r*u,f=r*c,l=a*u,m=a*c,M=o*c,T=i*s,p=i*u,v=i*c;return t[0]=1-(l+M),t[1]=h+v,t[2]=f-p,t[3]=0,t[4]=h-v,t[5]=1-(d+M),t[6]=m+T,t[7]=0,t[8]=f+p,t[9]=m-T,t[10]=1-(d+l),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function _(t,e){var n=new u(3),r=-e[0],a=-e[1],o=-e[2],i=e[3],s=e[4],c=e[5],d=e[6],h=e[7],f=r*r+a*a+o*o+i*i;return f>0?(n[0]=2*(s*i+h*r+c*o-d*a)/f,n[1]=2*(c*i+h*a+d*r-s*o)/f,n[2]=2*(d*i+h*o+s*a-c*r)/f):(n[0]=2*(s*i+h*r+c*o-d*a),n[1]=2*(c*i+h*a+d*r-s*o),n[2]=2*(d*i+h*o+s*a-c*r)),L(t,e,n),t}function O(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function B(t,e){var n=e[0],r=e[1],a=e[2],o=e[4],i=e[5],s=e[6],u=e[8],c=e[9],d=e[10];return t[0]=Math.hypot(n,r,a),t[1]=Math.hypot(o,i,s),t[2]=Math.hypot(u,c,d),t}function N(t,e){var n=new u(3);B(n,e);var r=1/n[0],a=1/n[1],o=1/n[2],i=e[0]*r,s=e[1]*a,c=e[2]*o,d=e[4]*r,h=e[5]*a,f=e[6]*o,l=e[8]*r,m=e[9]*a,M=e[10]*o,T=i+h+M,p=0;return T>0?(p=2*Math.sqrt(T+1),t[3]=.25*p,t[0]=(f-m)/p,t[1]=(l-c)/p,t[2]=(s-d)/p):i>h&&i>M?(p=2*Math.sqrt(1+i-h-M),t[3]=(f-m)/p,t[0]=.25*p,t[1]=(s+d)/p,t[2]=(l+c)/p):h>M?(p=2*Math.sqrt(1+h-i-M),t[3]=(l-c)/p,t[0]=(s+d)/p,t[1]=.25*p,t[2]=(f+m)/p):(p=2*Math.sqrt(1+M-i-h),t[3]=(s-d)/p,t[0]=(l+c)/p,t[1]=(f+m)/p,t[2]=.25*p),t}function C(t,e,n,r){var a=e[0],o=e[1],i=e[2],s=e[3],u=a+a,c=o+o,d=i+i,h=a*u,f=a*c,l=a*d,m=o*c,M=o*d,T=i*d,p=s*u,v=s*c,g=s*d,b=r[0],E=r[1],x=r[2];return t[0]=(1-(m+T))*b,t[1]=(f+g)*b,t[2]=(l-v)*b,t[3]=0,t[4]=(f-g)*E,t[5]=(1-(h+T))*E,t[6]=(M+p)*E,t[7]=0,t[8]=(l+v)*x,t[9]=(M-p)*x,t[10]=(1-(h+m))*x,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function X(t,e,n,r,a){var o=e[0],i=e[1],s=e[2],u=e[3],c=o+o,d=i+i,h=s+s,f=o*c,l=o*d,m=o*h,M=i*d,T=i*h,p=s*h,v=u*c,g=u*d,b=u*h,E=r[0],x=r[1],w=r[2],R=a[0],y=a[1],S=a[2],D=(1-(M+p))*E,P=(l+b)*E,F=(m-g)*E,A=(l-b)*x,U=(1-(f+p))*x,I=(T+v)*x,L=(m+g)*w,_=(T-v)*w,O=(1-(f+M))*w;return t[0]=D,t[1]=P,t[2]=F,t[3]=0,t[4]=A,t[5]=U,t[6]=I,t[7]=0,t[8]=L,t[9]=_,t[10]=O,t[11]=0,t[12]=n[0]+R-(D*R+A*y+L*S),t[13]=n[1]+y-(P*R+U*y+_*S),t[14]=n[2]+S-(F*R+I*y+O*S),t[15]=1,t}function q(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=n+n,s=r+r,u=a+a,c=n*i,d=r*i,h=r*s,f=a*i,l=a*s,m=a*u,M=o*i,T=o*s,p=o*u;return t[0]=1-h-m,t[1]=d+p,t[2]=f-T,t[3]=0,t[4]=d-p,t[5]=1-c-m,t[6]=l+M,t[7]=0,t[8]=f+T,t[9]=l-M,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function G(t,e,n,r,a,o,i){var s=1/(n-e),u=1/(a-r),c=1/(o-i);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(a+r)*u,t[10]=(i+o)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=i*o*2*c,t[15]=0,t}function k(t,e,n,r,a){var o,i=1/Math.tan(e/2);return t[0]=i/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=a&&a!==1/0?(o=1/(r-a),t[10]=(a+r)*o,t[14]=2*a*r*o):(t[10]=-1,t[14]=-2*r),t}function z(t,e,n,r){var a=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),i=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(i+s),c=2/(a+o);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(i-s)*u*.5,t[9]=(a-o)*c*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function V(t,e,n,r,a,o,i){var s=1/(e-n),u=1/(r-a),c=1/(o-i);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*s,t[13]=(a+r)*u,t[14]=(i+o)*c,t[15]=1,t}function $(t,e,n,r){var a,o,i,u,c,d,h,f,l,m,T=e[0],p=e[1],v=e[2],g=r[0],b=r[1],E=r[2],x=n[0],w=n[1],R=n[2];return Math.abs(T-x)<s&&Math.abs(p-w)<s&&Math.abs(v-R)<s?M(t):(h=T-x,f=p-w,l=v-R,a=b*(l*=m=1/Math.hypot(h,f,l))-E*(f*=m),o=E*(h*=m)-g*l,i=g*f-b*h,(m=Math.hypot(a,o,i))?(a*=m=1/m,o*=m,i*=m):(a=0,o=0,i=0),u=f*i-l*o,c=l*a-h*i,d=h*o-f*a,(m=Math.hypot(u,c,d))?(u*=m=1/m,c*=m,d*=m):(u=0,c=0,d=0),t[0]=a,t[1]=u,t[2]=h,t[3]=0,t[4]=o,t[5]=c,t[6]=f,t[7]=0,t[8]=i,t[9]=d,t[10]=l,t[11]=0,t[12]=-(a*T+o*p+i*v),t[13]=-(u*T+c*p+d*v),t[14]=-(h*T+f*p+l*v),t[15]=1,t)}function H(t,e,n,r){var a=e[0],o=e[1],i=e[2],s=r[0],u=r[1],c=r[2],d=a-n[0],h=o-n[1],f=i-n[2],l=d*d+h*h+f*f;l>0&&(d*=l=1/Math.sqrt(l),h*=l,f*=l);var m=u*f-c*h,M=c*d-s*f,T=s*h-u*d;return(l=m*m+M*M+T*T)>0&&(m*=l=1/Math.sqrt(l),M*=l,T*=l),t[0]=m,t[1]=M,t[2]=T,t[3]=0,t[4]=h*T-f*M,t[5]=f*m-d*T,t[6]=d*M-h*m,t[7]=0,t[8]=d,t[9]=h,t[10]=f,t[11]=0,t[12]=a,t[13]=o,t[14]=i,t[15]=1,t}function j(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Y(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function W(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function K(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function Z(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function Q(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function J(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function tt(t,e){var n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],u=t[5],c=t[6],d=t[7],h=t[8],f=t[9],l=t[10],m=t[11],M=t[12],T=t[13],p=t[14],v=t[15],g=e[0],b=e[1],E=e[2],x=e[3],w=e[4],R=e[5],y=e[6],S=e[7],D=e[8],P=e[9],F=e[10],A=e[11],U=e[12],I=e[13],L=e[14],_=e[15];return Math.abs(n-g)<=s*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(r-b)<=s*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(a-E)<=s*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(o-x)<=s*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(i-w)<=s*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(u-R)<=s*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(c-y)<=s*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(d-S)<=s*Math.max(1,Math.abs(d),Math.abs(S))&&Math.abs(h-D)<=s*Math.max(1,Math.abs(h),Math.abs(D))&&Math.abs(f-P)<=s*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(l-F)<=s*Math.max(1,Math.abs(l),Math.abs(F))&&Math.abs(m-A)<=s*Math.max(1,Math.abs(m),Math.abs(A))&&Math.abs(M-U)<=s*Math.max(1,Math.abs(M),Math.abs(U))&&Math.abs(T-I)<=s*Math.max(1,Math.abs(T),Math.abs(I))&&Math.abs(p-L)<=s*Math.max(1,Math.abs(p),Math.abs(L))&&Math.abs(v-_)<=s*Math.max(1,Math.abs(v),Math.abs(_))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var et=b,nt=K;function rt(){var t=new u(2);return u!=Float32Array&&(t[0]=0,t[1]=0),t}function at(t){var e=new u(2);return e[0]=t[0],e[1]=t[1],e}function ot(t,e){var n=new u(2);return n[0]=t,n[1]=e,n}function it(t,e){return t[0]=e[0],t[1]=e[1],t}function st(t,e,n){return t[0]=e,t[1]=n,t}function ut(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function ct(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function dt(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function ht(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function ft(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function lt(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function mt(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t}function Mt(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t}function Tt(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function pt(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function vt(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t}function gt(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.hypot(n,r)}function bt(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function Et(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function xt(t){var e=t[0],n=t[1];return e*e+n*n}function wt(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Rt(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function yt(t,e){var n=e[0],r=e[1],a=n*n+r*r;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t}function St(t,e){return t[0]*e[0]+t[1]*e[1]}function Dt(t,e,n){var r=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=r,t}function Pt(t,e,n,r){var a=e[0],o=e[1];return t[0]=a+r*(n[0]-a),t[1]=o+r*(n[1]-o),t}function Ft(t,e){e=e||1;var n=2*c()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t}function At(t,e,n){var r=e[0],a=e[1];return t[0]=n[0]*r+n[2]*a,t[1]=n[1]*r+n[3]*a,t}function Ut(t,e,n){var r=e[0],a=e[1];return t[0]=n[0]*r+n[2]*a+n[4],t[1]=n[1]*r+n[3]*a+n[5],t}function It(t,e,n){var r=e[0],a=e[1];return t[0]=n[0]*r+n[3]*a+n[6],t[1]=n[1]*r+n[4]*a+n[7],t}function Lt(t,e,n){var r=e[0],a=e[1];return t[0]=n[0]*r+n[4]*a+n[12],t[1]=n[1]*r+n[5]*a+n[13],t}function _t(t,e,n,r){var a=e[0]-n[0],o=e[1]-n[1],i=Math.sin(r),s=Math.cos(r);return t[0]=a*s-o*i+n[0],t[1]=a*i+o*s+n[1],t}function Ot(t,e){var n=t[0],r=t[1],a=e[0],o=e[1],i=Math.sqrt(n*n+r*r)*Math.sqrt(a*a+o*o),s=i&&(n*a+r*o)/i;return Math.acos(Math.min(Math.max(s,-1),1))}function Bt(t){return t[0]=0,t[1]=0,t}function Nt(t){return"vec2("+t[0]+", "+t[1]+")"}function Ct(t,e){return t[0]===e[0]&&t[1]===e[1]}function Xt(t,e){var n=t[0],r=t[1],a=e[0],o=e[1];return Math.abs(n-a)<=s*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-o)<=s*Math.max(1,Math.abs(r),Math.abs(o))}var qt,Gt=Et,kt=ct,zt=dt,Vt=ht,$t=gt,Ht=bt,jt=xt,Yt=(qt=rt(),function(t,e,n,r,a,o){var i,s;for(e||(e=2),n||(n=0),s=r?Math.min(r*e+n,t.length):t.length,i=n;i<s;i+=e)qt[0]=t[i],qt[1]=t[i+1],a(qt,qt,o),t[i]=qt[0],t[i+1]=qt[1];return t});function Wt(){var t=new u(3);return u!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Kt(t){var e=new u(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Zt(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function Qt(t,e,n){var r=new u(3);return r[0]=t,r[1]=e,r[2]=n,r}function Jt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function te(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function ee(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function ne(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function re(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function ae(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function oe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function ie(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function se(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function ue(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function ce(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function de(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function he(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function fe(t,e){var n=e[0]-t[0],r=e[1]-t[1],a=e[2]-t[2];return Math.hypot(n,r,a)}function le(t,e){var n=e[0]-t[0],r=e[1]-t[1],a=e[2]-t[2];return n*n+r*r+a*a}function me(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function Me(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Te(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function pe(t,e){var n=e[0],r=e[1],a=e[2],o=n*n+r*r+a*a;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function ve(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ge(t,e,n){var r=e[0],a=e[1],o=e[2],i=n[0],s=n[1],u=n[2];return t[0]=a*u-o*s,t[1]=o*i-r*u,t[2]=r*s-a*i,t}function be(t,e,n,r){var a=e[0],o=e[1],i=e[2];return t[0]=a+r*(n[0]-a),t[1]=o+r*(n[1]-o),t[2]=i+r*(n[2]-i),t}function Ee(t,e,n,r,a,o){var i=o*o,s=i*(2*o-3)+1,u=i*(o-2)+o,c=i*(o-1),d=i*(3-2*o);return t[0]=e[0]*s+n[0]*u+r[0]*c+a[0]*d,t[1]=e[1]*s+n[1]*u+r[1]*c+a[1]*d,t[2]=e[2]*s+n[2]*u+r[2]*c+a[2]*d,t}function xe(t,e,n,r,a,o){var i=1-o,s=i*i,u=o*o,c=s*i,d=3*o*s,h=3*u*i,f=u*o;return t[0]=e[0]*c+n[0]*d+r[0]*h+a[0]*f,t[1]=e[1]*c+n[1]*d+r[1]*h+a[1]*f,t[2]=e[2]*c+n[2]*d+r[2]*h+a[2]*f,t}function we(t,e){e=e||1;var n=2*c()*Math.PI,r=2*c()-1,a=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*a,t[1]=Math.sin(n)*a,t[2]=r*e,t}function Re(t,e,n){var r=e[0],a=e[1],o=e[2],i=n[3]*r+n[7]*a+n[11]*o+n[15];return i=i||1,t[0]=(n[0]*r+n[4]*a+n[8]*o+n[12])/i,t[1]=(n[1]*r+n[5]*a+n[9]*o+n[13])/i,t[2]=(n[2]*r+n[6]*a+n[10]*o+n[14])/i,t}function ye(t,e,n){var r=e[0],a=e[1],o=e[2];return t[0]=r*n[0]+a*n[3]+o*n[6],t[1]=r*n[1]+a*n[4]+o*n[7],t[2]=r*n[2]+a*n[5]+o*n[8],t}function Se(t,e,n){var r=n[0],a=n[1],o=n[2],i=n[3],s=e[0],u=e[1],c=e[2],d=a*c-o*u,h=o*s-r*c,f=r*u-a*s,l=a*f-o*h,m=o*d-r*f,M=r*h-a*d,T=2*i;return d*=T,h*=T,f*=T,l*=2,m*=2,M*=2,t[0]=s+d+l,t[1]=u+h+m,t[2]=c+f+M,t}function De(t,e,n,r){var a=[],o=[];return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],o[0]=a[0],o[1]=a[1]*Math.cos(r)-a[2]*Math.sin(r),o[2]=a[1]*Math.sin(r)+a[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function Pe(t,e,n,r){var a=[],o=[];return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],o[0]=a[2]*Math.sin(r)+a[0]*Math.cos(r),o[1]=a[1],o[2]=a[2]*Math.cos(r)-a[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function Fe(t,e,n,r){var a=[],o=[];return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],o[0]=a[0]*Math.cos(r)-a[1]*Math.sin(r),o[1]=a[0]*Math.sin(r)+a[1]*Math.cos(r),o[2]=a[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function Ae(t,e){var n=t[0],r=t[1],a=t[2],o=e[0],i=e[1],s=e[2],u=Math.sqrt(n*n+r*r+a*a)*Math.sqrt(o*o+i*i+s*s),c=u&&ve(t,e)/u;return Math.acos(Math.min(Math.max(c,-1),1))}function Ue(t){return t[0]=0,t[1]=0,t[2]=0,t}function Ie(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Le(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function _e(t,e){var n=t[0],r=t[1],a=t[2],o=e[0],i=e[1],u=e[2];return Math.abs(n-o)<=s*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-i)<=s*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(a-u)<=s*Math.max(1,Math.abs(a),Math.abs(u))}var Oe=ne,Be=re,Ne=ae,Ce=fe,Xe=le,qe=Zt,Ge=me,ke=function(){var t=Wt();return function(e,n,r,a,o,i){var s,u;for(n||(n=3),r||(r=0),u=a?Math.min(a*n+r,e.length):e.length,s=r;s<u;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],o(t,t,i),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}();function ze(){var t=new u(4);return u!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Ve(t){var e=new u(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function $e(t,e,n,r){var a=new u(4);return a[0]=t,a[1]=e,a[2]=n,a[3]=r,a}function He(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function je(t,e,n,r,a){return t[0]=e,t[1]=n,t[2]=r,t[3]=a,t}function Ye(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function We(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function Ke(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function Ze(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function Qe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Je(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function tn(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t}function en(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t}function nn(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function rn(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function an(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t}function on(t,e){var n=e[0]-t[0],r=e[1]-t[1],a=e[2]-t[2],o=e[3]-t[3];return Math.hypot(n,r,a,o)}function sn(t,e){var n=e[0]-t[0],r=e[1]-t[1],a=e[2]-t[2],o=e[3]-t[3];return n*n+r*r+a*a+o*o}function un(t){var e=t[0],n=t[1],r=t[2],a=t[3];return Math.hypot(e,n,r,a)}function cn(t){var e=t[0],n=t[1],r=t[2],a=t[3];return e*e+n*n+r*r+a*a}function dn(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function hn(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function fn(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=n*n+r*r+a*a+o*o;return i>0&&(i=1/Math.sqrt(i)),t[0]=n*i,t[1]=r*i,t[2]=a*i,t[3]=o*i,t}function ln(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function mn(t,e,n,r){var a=n[0]*r[1]-n[1]*r[0],o=n[0]*r[2]-n[2]*r[0],i=n[0]*r[3]-n[3]*r[0],s=n[1]*r[2]-n[2]*r[1],u=n[1]*r[3]-n[3]*r[1],c=n[2]*r[3]-n[3]*r[2],d=e[0],h=e[1],f=e[2],l=e[3];return t[0]=h*c-f*u+l*s,t[1]=-d*c+f*i-l*o,t[2]=d*u-h*i+l*a,t[3]=-d*s+h*o-f*a,t}function Mn(t,e,n,r){var a=e[0],o=e[1],i=e[2],s=e[3];return t[0]=a+r*(n[0]-a),t[1]=o+r*(n[1]-o),t[2]=i+r*(n[2]-i),t[3]=s+r*(n[3]-s),t}function Tn(t,e){var n,r,a,o,i,s;e=e||1;do{i=(n=2*c()-1)*n+(r=2*c()-1)*r}while(i>=1);do{s=(a=2*c()-1)*a+(o=2*c()-1)*o}while(s>=1);var u=Math.sqrt((1-i)/s);return t[0]=e*n,t[1]=e*r,t[2]=e*a*u,t[3]=e*o*u,t}function pn(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3];return t[0]=n[0]*r+n[4]*a+n[8]*o+n[12]*i,t[1]=n[1]*r+n[5]*a+n[9]*o+n[13]*i,t[2]=n[2]*r+n[6]*a+n[10]*o+n[14]*i,t[3]=n[3]*r+n[7]*a+n[11]*o+n[15]*i,t}function vn(t,e,n){var r=e[0],a=e[1],o=e[2],i=n[0],s=n[1],u=n[2],c=n[3],d=c*r+s*o-u*a,h=c*a+u*r-i*o,f=c*o+i*a-s*r,l=-i*r-s*a-u*o;return t[0]=d*c+l*-i+h*-u-f*-s,t[1]=h*c+l*-s+f*-i-d*-u,t[2]=f*c+l*-u+d*-s-h*-i,t[3]=e[3],t}function gn(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function bn(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function En(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function xn(t,e){var n=t[0],r=t[1],a=t[2],o=t[3],i=e[0],u=e[1],c=e[2],d=e[3];return Math.abs(n-i)<=s*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-u)<=s*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(a-c)<=s*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(o-d)<=s*Math.max(1,Math.abs(o),Math.abs(d))}var wn=We,Rn=Ke,yn=Ze,Sn=on,Dn=sn,Pn=un,Fn=cn,An=function(){var t=ze();return function(e,n,r,a,o,i){var s,u;for(n||(n=4),r||(r=0),u=a?Math.min(a*n+r,e.length):e.length,s=r;s<u;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],o(t,t,i),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}();function Un(t){let e=t;return e=((170&e)>>1)+(85&e),e=((204&e)>>2)+(51&e),e=((240&e)>>4)+(15&e),e}class In{constructor(){this.bboxStart=o.create(),this.bboxEnd=o.create(),this.bboxCenter=o.create()}}class Ln extends In{constructor(){super(...arguments),this.initialized=!1,this.dataLoadedOffset=0,this.renderPreferences={}}load(t){const e=this.parseHeader(t);this.nodes.set(new Uint32Array(t.slice(e)))}parseHeader(t){let e=0;this.bboxStart.set(new Float32Array(t.slice(e,e+12))),e+=12,this.bboxEnd.set(new Float32Array(t.slice(e,e+12))),e+=12,this.rootSide=new Float32Array(t.slice(e,e+4))[0],e+=4,this.nLevels=new Uint32Array(t.slice(e,e+4))[0],e+=4,this.nNodes=new Uint32Array(t.slice(e,e+4))[0],e+=4;new Uint32Array(t.slice(e,e+4))[0];e+=4;const n=new Uint32Array(t.slice(e,e+4))[0];return this.originalNodeLength=n,e+=4,this.nodes=new Uint32Array(n),o.sub(this.bboxCenter,this.bboxEnd,this.bboxStart),o.scaleAndAdd(this.bboxCenter,this.bboxStart,this.bboxCenter,.5),e}loadChunk(t){if(this.initialized)this.nodes.set(new Uint32Array(t.buffer),this.dataLoadedOffset/4),this.dataLoadedOffset+=t.length;else{const e=this.parseHeader(t.buffer);this.initialized=!0,(t.length-e)/4!==this.nodes.length&&this.nodes.fill(Math.pow(2,31)-1),this.loadChunk(t.slice(e))}}castRay(t,e,n=100){const r=this.rootSide/Math.pow(2,this.nLevels-1),a=o.copy(o.create(),t);for(let t=0;t<n;t++){o.scaleAndAdd(a,a,e,r);const t=this.getVoxel(a);if(t)return{...t,maxRayLength:r*n}}return null}getVoxel(t){const e=o.create();e.set(this.bboxCenter);let n=0,r=this.rootSide/2;for(let a=0;a<this.nLevels;a++){const o=(t[0]>e[0]?4:0)+(t[1]>e[1]?2:0)+(t[2]>e[2]?1:0),i=this.nodes[n];if(!(0!=(i&1<<o)))return null;if(a===this.nLevels-1)return{nodeIndex:n,hitPos:e};r/=2,e[0]+=t[0]>e[0]?r:-r,e[1]+=t[1]>e[1]?r:-r,e[2]+=t[2]>e[2]?r:-r;const s=Un(i>>o);n=this.nodes[n+s]}return null}}var _n=class{constructor(t=60){this.position=o.create(),this.target=o.create(),this.upDir=o.create(),this.viewMat=r.create(),this.viewMatInv=r.create(),this.projMat=r.create(),this.projMatInv=r.create(),this.fovY=3.14159265359*t/180,o.set(this.upDir,0,1,0)}fromHomog(t){return o.divide(o.create(),o.fromValues(t[0],t[1],t[2]),o.fromValues(t[3],t[3],t[3]))}updateMatrices(){r.lookAt(this.viewMat,this.position,this.target,this.upDir),r.perspective(this.projMat,this.fovY,window.innerWidth/window.innerHeight,.1,1),r.invert(this.projMatInv,this.projMat),r.invert(this.viewMatInv,this.viewMat)}computeCameraRay(t){const e=i.fromValues(t[0],t[1],0,1),n=i.fromValues(t[0],t[1],1,1),r=this.fromHomog(i.transformMat4(i.create(),e,this.projMatInv)),a=this.fromHomog(i.transformMat4(i.create(),n,this.projMatInv)),s={o:o.fromValues(0,0,0),d:o.normalize(o.create(),o.subtract(o.create(),a,r))};i.transformMat4(i.create(),i.fromValues(s.o[0],s.o[1],s.o[2],1),this.viewMatInv),i.transformMat4(i.create(),i.fromValues(s.d[0],s.d[1],s.d[2],1),this.viewMatInv);return s}updatePosition(){const t=o.subtract(o.create(),this.position,this.target);console.log(t),o.transformMat4(this.position,t,this.viewMat),o.add(this.position,this.position,this.target)}};async function On(t,e,n){const r=t.getParameter(t.MAX_3D_TEXTURE_SIZE),a=r*r,o=await fetch("raycast.glsl");let i=await o.text();const s=`#version 300 es\n#define INNER_LEVELS ${2*e-1}u\n#define TEX3D_SIZE ${r}\n#define TEX3D_SIZE_POW2 ${a}\n#define VIEWER_MODE ${"viewer"===n?1:0}\n#define DEPTH_MODE ${"depth"===n?1:0}\n#define PATH_TRACE_MODE ${"pathtracing"===n?1:0}\n`;i=s+"\n"+i.split("\n").splice(s.split("\n").length).join("\n");const u=t.createShader(t.FRAGMENT_SHADER);return t.shaderSource(u,i),t.compileShader(u),console.log(`Raycast shader (${n}): `,t.getShaderInfoLog(u)||"OK"),u}function Bn(t,e,n){const r=t.createProgram();if(t.attachShader(r,e),t.attachShader(r,n),t.linkProgram(r),!t.getProgramParameter(r,t.LINK_STATUS))throw"Could not compile WebGL program. \n\n"+t.getProgramInfoLog(r);return t.useProgram(r),r}const Nn=["time","resolution","viewMatInv","projMatInv","sceneBBoxMin","sceneBBoxMax","sceneCenter","rootHalfSide","maxIters","drawLevel","projectionFactor","nodes","viewerRenderMode","selectedVoxelIndex","uniqueColors","lightPos","enableShadows","normalEpsilon","minDepthTex","useBeamOptimization","depthTex","hitNormTex","ptFrame","prevFrameTex","nPathTraceBounces","depthOfField"],Cn=["depthTex","viewProjMatInv"],Xn=["tex"];var qn;!function(t){t[t.ITERATIONS=0]="ITERATIONS",t[t.DEPTH=1]="DEPTH",t[t.DIFFUSE_LIGHTING=2]="DIFFUSE_LIGHTING",t[t.PATH_TRACING=3]="PATH_TRACING",t[t.NORMAL=4]="NORMAL"}(qn||(qn={}));class Gn{constructor(t,e){this.camera=t,this.canvas=e,this.state={startTime:(new Date).getTime()/1e3,time:0,frame:0,pathTraceFrame:0,pixelTolerance:1,renderScale:1,drawLevel:1,maxIterations:250,renderMode:qn.NORMAL,useBeamOptimization:!0,showUniqueNodeColors:!1,nPathTraceBounces:1,depthOfField:0,selectedVoxelIndex:-1,lightPos:o.create()},this.gl=e.getContext("webgl2"),this.maxT3DTexels=this.gl.getParameter(this.gl.MAX_3D_TEXTURE_SIZE)}initialize(){const{gl:t,canvas:e}=this,n=Math.ceil(e.width/8),r=Math.ceil(e.height/8);[this.minDepthFBO,this.minDepthTex]=this.setupTexFBO(t.TEXTURE1,{width:n,height:r}),[this.fullDepthFBO,this.fullDepthTex]=this.setupTexFBO(t.TEXTURE2),[this.normalFBO,this.normalTex]=this.setupTexFBO(t.TEXTURE3,{internalFormat:t.RGB8,format:t.RGB,type:t.UNSIGNED_BYTE}),[this.ptFBO1,this.ptTex1]=this.setupTexFBO(t.TEXTURE4,{internalFormat:t.RGBA32F,format:t.RGBA,type:t.FLOAT}),[this.ptFBO2,this.ptTex2]=this.setupTexFBO(t.TEXTURE5,{internalFormat:t.RGBA32F,format:t.RGBA,type:t.FLOAT})}prepPathTraceRender(){const{gl:t,state:{pathTraceFrame:e}}=this;return e%2==0?(t.uniform1i(this.pathTraceUniformDict.prevFrameTex,5),t.bindFramebuffer(t.FRAMEBUFFER,this.ptFBO1),t.activeTexture(t.TEXTURE4),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE5),t.bindTexture(t.TEXTURE_2D,this.ptTex2),{uniform:4,slot:t.TEXTURE4,texture:this.ptTex1}):(t.uniform1i(this.pathTraceUniformDict.prevFrameTex,4),t.bindFramebuffer(t.FRAMEBUFFER,this.ptFBO2),t.activeTexture(t.TEXTURE4),t.bindTexture(t.TEXTURE_2D,this.ptTex1),t.activeTexture(t.TEXTURE5),t.bindTexture(t.TEXTURE_2D,null),{uniform:5,slot:t.TEXTURE5,texture:this.ptTex2})}render(){const{gl:t,canvas:e,state:n,viewerUniformDict:r,depthUniformDict:a,normalUniformDict:o,texUniformDict:i}=this;if(this.state.useBeamOptimization&&!(n.renderMode===qn.PATH_TRACING&&n.pathTraceFrame>0)){t.useProgram(this.depthProgram),t.bindFramebuffer(t.FRAMEBUFFER,this.minDepthFBO),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,null);const n=Math.ceil(e.width/8),r=Math.ceil(e.height/8);this.setInitialUniforms(a),t.uniform2f(a.resolution,n,r),t.uniform1i(a.useBeamOptimization,0),t.uniform1f(a.projectionFactor,this.getProjectionFactor(1,8)),t.viewport(0,0,n,r),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.drawArrays(t.TRIANGLES,0,3),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this.minDepthTex)}if(n.renderMode===qn.NORMAL&&(t.useProgram(this.depthProgram),t.bindFramebuffer(t.FRAMEBUFFER,this.fullDepthFBO),t.activeTexture(t.TEXTURE2),t.bindTexture(t.TEXTURE_2D,null),this.setInitialUniforms(a),t.viewport(0,0,e.width,e.height),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.drawArrays(t.TRIANGLES,0,3),t.activeTexture(t.TEXTURE2),t.bindTexture(t.TEXTURE_2D,this.fullDepthTex),t.useProgram(this.normalProgram),t.bindFramebuffer(t.FRAMEBUFFER,this.normalFBO),t.activeTexture(t.TEXTURE3),t.bindTexture(t.TEXTURE_2D,null),this.setNormalUniforms(o),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.drawArrays(t.TRIANGLES,0,3),t.activeTexture(t.TEXTURE3),t.bindTexture(t.TEXTURE_2D,this.normalTex)),n.renderMode===qn.PATH_TRACING){if(n.pathTraceFrame>64)return;t.useProgram(this.pathTraceProgram);const{uniform:r,slot:a,texture:o}=this.prepPathTraceRender();return t.useProgram(this.pathTraceProgram),this.setInitialUniforms(this.pathTraceUniformDict),t.viewport(0,0,e.width,e.height),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT),t.drawArrays(t.TRIANGLES,0,3),t.bindFramebuffer(t.FRAMEBUFFER,null),t.activeTexture(a),t.bindTexture(t.TEXTURE_2D,o),t.useProgram(this.texProgram),t.uniform1i(i.tex,r),t.viewport(0,0,e.width,e.height),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT),t.drawArrays(t.TRIANGLES,0,3),void n.pathTraceFrame++}t.bindFramebuffer(t.FRAMEBUFFER,null),t.useProgram(this.viewerProgram),this.setInitialUniforms(r),t.viewport(0,0,e.width,e.height),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT),t.drawArrays(t.TRIANGLES,0,3),n.frame++}initScene(t){this.svdag=t,this.state.lightPos.set(t.bboxEnd)}async initShaders(){const{gl:t,svdag:e}=this,n=function(t){const e=t.createShader(t.VERTEX_SHADER);return t.shaderSource(e,"#version 300 es\n    uniform float time;\n    void main(void) {\n      vec2 outUV = vec2((gl_VertexID << 1) & 2, gl_VertexID & 2);\n      outUV = outUV * 2.0f - 1.0f;\n      // gl_Position = vec4(outUV * (1.0 / time) + vec2(cos(time * time), sin(time * time)), 0.0f, 1.0f); // wiggly test\n      gl_Position = vec4(outUV, 0.0f, 1.0f);\n    }\n  "),t.compileShader(e),console.log("Vert shader: ",t.getShaderInfoLog(e)||"OK"),e}(t),r=await On(t,e.nLevels,"viewer"),a=await On(t,e.nLevels,"depth"),o=await async function(t){const e=await fetch("normalFromDepth.glsl"),n=await e.text(),r=t.createShader(t.FRAGMENT_SHADER);return t.shaderSource(r,n),t.compileShader(r),console.log("Normal shader: ",t.getShaderInfoLog(r)||"OK"),r}(t),i=await On(t,e.nLevels,"pathtracing"),s=function(t){const e=t.createShader(t.FRAGMENT_SHADER);return t.shaderSource(e,"#version 300 es\n    precision highp float;\n    out vec4 fragColor;\n    uniform sampler2D tex;\n\n    void main () {\n      vec3 color = texelFetch(tex, ivec2(gl_FragCoord.xy), 0).rgb;\n      fragColor = vec4(color, 1);\n    }\n  "),t.compileShader(e),console.log("Texture shader: ",t.getShaderInfoLog(e)||"OK"),e}(t);this.viewerProgram=Bn(t,n,r),this.depthProgram=Bn(t,n,a),this.normalProgram=Bn(t,n,o),this.pathTraceProgram=Bn(t,n,i),this.texProgram=Bn(t,n,s),t.useProgram(this.viewerProgram)}setupTexFBO(t=this.gl.TEXTURE0,{internalFormat:e=this.gl.RGBA32F,format:n=this.gl.RGBA,type:r=this.gl.FLOAT,width:a=this.canvas.width,height:o=this.canvas.height,magFilter:i=this.gl.NEAREST,minFilter:s=this.gl.NEAREST,wrapS:u=this.gl.CLAMP_TO_EDGE,wrapT:c=this.gl.CLAMP_TO_EDGE}={}){const{gl:d}=this,h=d.createFramebuffer(),f=d.createTexture();d.bindFramebuffer(d.FRAMEBUFFER,h),d.activeTexture(t),d.bindTexture(d.TEXTURE_2D,f),d.texImage2D(d.TEXTURE_2D,0,e,a,o,0,n,r,null),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,s),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,u),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,c),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,f,0),d.drawBuffers([d.COLOR_ATTACHMENT0]);const l=d.checkFramebufferStatus(d.FRAMEBUFFER);return l!==d.FRAMEBUFFER_COMPLETE&&console.error("FBO error",l),[h,f]}initUniforms(){const{gl:t}=this;this.viewerUniformDict={},this.depthUniformDict={},this.normalUniformDict={},this.pathTraceUniformDict={},this.texUniformDict={},Nn.forEach(e=>this.viewerUniformDict[e]=t.getUniformLocation(this.viewerProgram,e)),Nn.forEach(e=>this.depthUniformDict[e]=t.getUniformLocation(this.depthProgram,e)),Cn.forEach(e=>this.normalUniformDict[e]=t.getUniformLocation(this.normalProgram,e)),Nn.forEach(e=>this.pathTraceUniformDict[e]=t.getUniformLocation(this.pathTraceProgram,e)),Xn.forEach(e=>this.texUniformDict[e]=t.getUniformLocation(this.texProgram,e))}getProjectionFactor(t,e){const{canvas:n,camera:r}=this;return 1/(2*Math.tan(.5*r.fovY))/(t/(n.height/e))}setInitialUniforms(t){const{canvas:e,gl:n,camera:r,svdag:a,state:o}=this;n.uniform2f(t.resolution,e.width,e.height),n.uniform1i(t.nodes,0),n.uniform3fv(t.sceneBBoxMin,a.bboxStart),n.uniform3fv(t.sceneBBoxMax,a.bboxEnd),n.uniform3fv(t.sceneCenter,a.bboxCenter),n.uniform1f(t.rootHalfSide,a.rootSide/2),n.uniform3fv(t.lightPos,a.bboxEnd),n.uniform1ui(t.maxIters,o.maxIterations),n.uniform1ui(t.drawLevel,o.drawLevel),n.uniform1f(t.projectionFactor,this.getProjectionFactor(o.pixelTolerance,1)),n.uniform1i(t.uniqueColors,o.showUniqueNodeColors?1:0),n.uniform1i(t.viewerRenderMode,o.renderMode),n.uniformMatrix4fv(t.viewMatInv,!1,r.viewMatInv),n.uniformMatrix4fv(t.projMatInv,!1,r.projMatInv),n.uniform1f(t.time,(new Date).getTime()/1e3-o.startTime),n.uniform1ui(t.ptFrame,o.pathTraceFrame),n.uniform1i(t.nPathTraceBounces,o.nPathTraceBounces),n.uniform1f(t.depthOfField,o.depthOfField),n.uniform1i(t.useBeamOptimization,o.useBeamOptimization?1:0),n.uniform1i(t.minDepthTex,1),n.uniform1i(t.depthTex,2),n.uniform1i(t.hitNormTex,3)}setNormalUniforms(t){const{gl:e,camera:n}=this;e.uniformMatrix4fv(t.viewProjMatInv,!1,n.projMatInv),e.uniform1i(t.depthTex,2)}createNodesTexture(){const{gl:t}=this;this.texture=t.createTexture(),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_3D,this.texture),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_WRAP_R,t.REPEAT)}deleteNodesTexture(){void 0!==this.texture&&this.gl.deleteTexture(this.texture)}uploadTexData(t){const{gl:e,svdag:n,maxT3DTexels:r}=this,a=r*r,o=n.nodes.length,i=Math.ceil(o/a),s=a*i,u=n.dataLoadedOffset/4-t;if(console.log(u,n.dataLoadedOffset/4,t),e.activeTexture(e.TEXTURE0),0===u){if(console.log(`Initial uploading of nodes to 3D texture (Resolution: ${r} x ${r} x ${i}, nNodes: ${n.dataLoadedOffset}/${n.nodes.length})...`),n.nodes.length!=s){console.log("Resizing node buffer from ",n.nodes.length,"to",s,"(3D Texture padding)");const t=new Uint32Array(s);t.set(n.nodes),n.nodes=t}e.texStorage3D(e.TEXTURE_3D,1,e.R32UI,r,r,i),e.texSubImage3D(e.TEXTURE_3D,0,0,0,0,r,r,i,e.RED_INTEGER,e.UNSIGNED_INT,n.nodes)}else{const o=0,s=0,c=Math.floor(u/a),d=c,h=Math.floor(n.dataLoadedOffset/4/a),f=r,l=r,m=h-d+1,M=n.nodes.slice(s*r+d*a,r+l*r+h*a),T=Math.round(n.dataLoadedOffset/4/n.originalNodeLength*100);console.log(`Uploading data to 3D texture (${n.dataLoadedOffset/4}/${n.originalNodeLength} [${T}%])...`),console.log("#layers",i,"start",c,"chunkStart",u,"newNodes",t,"end",h,"depth",m),e.texSubImage3D(e.TEXTURE_3D,0,o,s,c,f,l,m,e.RED_INTEGER,e.UNSIGNED_INT,M)}}}var kn=class{constructor(t,e){this.camera=t,this.moveSpeed=e,this.prevMousePos=a.create(),this.mousePos=a.create(),this.tmpDir=o.create(),this.keyDownStatus={},this.radius=o.dist(this.camera.position,this.camera.target),o.normalize(this.tmpDir,o.sub(this.tmpDir,this.camera.target,this.camera.position))}init(){this.radius=o.dist(this.camera.position,this.camera.target),o.normalize(this.tmpDir,o.sub(this.tmpDir,this.camera.target,this.camera.position))}handleClick(t){o.subtract(o.create(),this.camera.target,this.camera.position)}update(t){let e=!1;this.keyDownStatus.shift&&(t*=10);const n=o.create();if((this.keyDownStatus.w||2===this.numTouches)&&(e=!0,o.normalize(n,o.sub(n,this.camera.target,this.camera.position)),this.moveInDirection(n,this.moveSpeed*t)),this.keyDownStatus.s&&(e=!0,o.normalize(n,o.sub(n,this.camera.target,this.camera.position)),this.moveInDirection(n,-this.moveSpeed*t)),this.keyDownStatus.a&&(e=!0,o.cross(n,o.normalize(n,o.sub(n,this.camera.position,this.camera.target)),this.camera.upDir),this.moveInDirection(n,this.moveSpeed*t)),this.keyDownStatus.d&&(e=!0,o.cross(n,o.normalize(n,o.sub(n,this.camera.position,this.camera.target)),this.camera.upDir),this.moveInDirection(n,-this.moveSpeed*t)),this.keyDownStatus.q&&(e=!0,o.normalize(n,o.sub(n,this.camera.target,this.camera.position)),this.rotateAlongLocalY(.5,t)),this.keyDownStatus.e&&(e=!0,o.normalize(n,o.sub(n,this.camera.target,this.camera.position)),this.rotateAlongLocalY(.5,-t)),this.keyDownStatus["mouse-0"]){e=!0;const t=a.subtract(a.create(),this.prevMousePos,this.mousePos);a.divide(t,t,[document.documentElement.clientWidth,document.documentElement.clientHeight]);const n=5;this.rotateAlongLocalY(t[0],n),this.rotateAlongLocalX(t[1],-n)}return e&&this.camera.updateMatrices(),this.prevMousePos.set(this.mousePos),e}moveInDirection(t,e){o.scaleAndAdd(this.camera.position,this.camera.position,t,e),o.scaleAndAdd(this.camera.target,this.camera.target,t,e)}rotateAlongLocalY(t,e){const n=r.rotate(r.create(),r.identity(r.create()),t*e,this.camera.upDir);o.transformMat4(this.tmpDir,this.tmpDir,n),o.scaleAndAdd(this.camera.target,this.camera.position,this.tmpDir,this.radius)}rotateAlongLocalX(t,e){const n=o.subtract(o.create(),this.camera.target,this.camera.position);o.normalize(n,n);const a=o.create();o.cross(a,this.camera.upDir,n);const i=r.create();r.rotate(i,r.identity(i),t*e,a),o.transformMat4(this.tmpDir,this.tmpDir,i),o.scaleAndAdd(this.camera.target,this.camera.position,this.tmpDir,this.radius)}rotateAroundPivot(t){}onKeyDown(t){this.keyDownStatus[t.key.toLocaleLowerCase()]=!0}onKeyUp(t){this.keyDownStatus[t.key.toLocaleLowerCase()]=!1}onMouseDown(t){this.keyDownStatus["mouse-"+t.button]=!0,this.prevMousePos.set([t.clientX,t.clientY]),this.mousePos.set(this.prevMousePos),this.handleClick(this.mousePos)}onTouchStart(t){this.keyDownStatus["mouse-0"]=!0,this.prevMousePos.set([t.touches[0].clientX,t.touches[0].clientY]),this.mousePos.set(this.prevMousePos),this.numTouches=t.touches.length}onMouseUp(t){this.keyDownStatus["mouse-"+t.button]=!1}onTouchEnd(t){this.keyDownStatus["mouse-0"]=!1,this.numTouches=0}onMouseMove(t){this.mousePos.set(a.fromValues(t.clientX,t.clientY))}onTouchMove(t){this.mousePos.set(a.fromValues(t.touches[0].clientX,t.touches[0].clientY)),this.numTouches=t.touches.length}onMouseWheel(t){window.setMoveSpeed(this.moveSpeed*=t.deltaY<0?1.1:.9)}};class zn{static async getGeneratedSceneList(){return[{label:"Cross fractal",getScene:async t=>zn.generateCrossFractal(t),loadType:"preloaded"},{label:"Menger sponge fractal",getScene:async t=>zn.generateMengerSpongeFractal(t),loadType:"preloaded"},{label:"Cube fractal",getScene:async t=>zn.generateCubeFractal(t),loadType:"preloaded"},{label:"Pyramid fractal",getScene:async t=>zn.generatePyramidFractal(t),loadType:"preloaded"}]}static async getPrebuiltSceneList(){try{return(await zn.fetchPrebuiltScenes()).map(t=>({label:`${t.fileName} (${t.size})`,downloadPath:t.absolutePath,loadType:"stream"}))}catch(t){return console.error("Could not fetch prebuilt scenes :(",t),[]}}static async fetchPrebuiltScenes(){const t="https://allaboutsteinsgate.info/dev/dagger/scenes/",e=await fetch(t+"?C=N;O=A"),n=await e.text(),r=(new DOMParser).parseFromString(n,"text/html");return Array.from(r.querySelectorAll("tr")).slice(3,-1).map(e=>({fileName:e.childNodes[1].innerText.trim().replace(".svdag",""),absolutePath:`${t}${e.querySelector("a").href.split("/").pop()}`,size:e.childNodes[3].innerText}))}static generateBaseFractal(t,e,n){return t.bboxStart.set([0,0,0]),t.bboxEnd.set([100,100,100]),o.sub(t.bboxCenter,t.bboxEnd,t.bboxStart),o.scaleAndAdd(t.bboxCenter,t.bboxStart,t.bboxCenter,.5),t.rootSide=100,t.nLevels=20,t.nNodes=e,t.nodes=n,t}static generatePyramidFractal(t){return t.renderPreferences={renderMode:qn.ITERATIONS,maxIterations:100,spawnPosition:o.fromValues(125,125,125)},zn.generateBaseFractal(t,1,new Uint32Array([232,0,0,0,0]))}static generateCubeFractal(t){return t.renderPreferences={renderMode:qn.PATH_TRACING,maxIterations:30,spawnPosition:o.fromValues(150,150,150),moveSpeed:16},zn.generateBaseFractal(t,2,new Uint32Array([255,9,9,9,9,9,9,9,9,127,0,0,0,0,0,0,0]))}static generateCrossFractal(t){return t.renderPreferences={renderMode:qn.PATH_TRACING,maxIterations:30,spawnPosition:o.fromValues(150,150,150),moveSpeed:16},zn.generateBaseFractal(t,9,new Uint32Array([255,...Array.from(Array(8).keys()).map(t=>9+8*t),127,0,0,0,0,0,0,0,191,0,0,0,0,0,0,0,223,0,0,0,0,0,0,0,239,0,0,0,0,0,0,0,247,0,0,0,0,0,0,0,251,0,0,0,0,0,0,0,253,0,0,0,0,0,0,0,254,0,0,0,0,0,0,0]))}static generateMengerSpongeFractal(t){return t.renderPreferences={renderMode:qn.PATH_TRACING,maxIterations:30,spawnPosition:o.fromValues(150,150,150),moveSpeed:16},zn.generateBaseFractal(t,5,new Uint32Array([255,...Array.from(Array(8).keys()).map(t=>9+5*t),232,0,0,0,0,212,0,0,0,0,178,0,0,0,0,113,0,0,0,0,142,0,0,0,0,77,0,0,0,0,43,0,0,0,0,23,0,0,0,0]))}}const Vn=WebGL2RenderingContext;let $n,Hn,jn;const Yn=[],Wn=new _n(60);let Kn;const Zn=window;let Qn=Date.now(),Jn=0,tr=1,er=Date.now(),nr=!1;function rr(t){Kn.state.renderScale=t,$n.width=window.innerWidth*Kn.state.renderScale,$n.height=window.innerHeight*Kn.state.renderScale,$n.style.transform=`translate(-50%, -50%) scale(${1/Kn.state.renderScale})`,document.getElementById("renderScale").value=""+Kn.state.renderScale,nr=!0}function ar(t){Kn.state.drawLevel=Math.max(1,Math.min(t,20)),document.getElementById("drawLevel").value=""+Kn.state.drawLevel,nr=!0}function or(t){console.log("setting render mode",t),Kn.state.renderMode="string"==typeof t?parseInt(t,10):t,document.getElementById("renderMode").value=""+Kn.state.renderMode,nr=!0}function ir(t){Hn.moveSpeed="number"==typeof t?t:parseFloat(t),document.getElementById("moveSpeed").value=Hn.moveSpeed.toFixed(1),nr=!0}function sr(t){Kn.state.maxIterations=Math.max(1,Math.min(t,1e3)),document.getElementById("maxIterations").value=Kn.state.maxIterations.toFixed(0),nr=!0}Zn.setRenderScale=rr.bind(void 0),Zn.setDrawLevel=ar.bind(void 0),Zn.setRenderMode=or.bind(void 0),Zn.setMoveSpeed=ir.bind(void 0),Zn.setMaxIterations=sr.bind(void 0),Zn.setPixelTolerance=function(t){Kn.state.pixelTolerance="number"==typeof t?t:parseFloat(t),document.getElementById("pixelTolerance").value=Kn.state.pixelTolerance.toFixed(2),nr=!0}.bind(void 0),Zn.setShowUniqueColors=function(t){Kn.state.showUniqueNodeColors=t,nr=!0}.bind(void 0),Zn.setUseBeamOptimization=function(t,e){if(Kn.state.useBeamOptimization=t,e){const e=document.getElementById("beamOptim");e.checked=t,e.disabled=!0}nr=!0}.bind(void 0),Zn.setNPathTraceBounces=function(t){Kn.state.nPathTraceBounces=Math.max(0,Math.min(parseInt(t.toString()),100)),document.getElementById("nPathTraceBounces").value=Kn.state.nPathTraceBounces.toString(),nr=!0}.bind(void 0),Zn.setDepthOfField=function(t){console.log(t),Kn.state.depthOfField=Math.max(0,Math.min(parseFloat(t.toString()),100)),document.getElementById("depthOfField").value=Kn.state.depthOfField.toString(),nr=!0}.bind(void 0);const ur=document.querySelector("#progress");async function cr(t){console.log("Streaming",t,"...");const e=(await fetch(t)).body.getReader(),{done:n,value:r}=await e.read(),a=new Ln;Kn.initScene(a),a.loadChunk(r),Kn.uploadTexData(a.dataLoadedOffset/4);let o=Math.round(a.dataLoadedOffset/4/a.originalNodeLength*100);const i=document.getElementById("load");i.disabled=!0,i.innerText=`Load (${o}%)`;const s=()=>{console.log("Finished loading!"),i.innerText="Load",i.disabled=!1};return n||o>=99?s():(async()=>{let t=new Date,n=a.dataLoadedOffset;for(;;){const{done:r,value:s}=await e.read();if(r)break;console.log(`Received ${s.byteLength} bytes (${s.length/1e6} MB)`),a.loadChunk(s),o=Math.round(a.dataLoadedOffset/4/a.originalNodeLength*100),i.innerText=`Load (${o}%)`;const u=new Date;u.getTime()-t.getTime()>1e3&&(Kn.uploadTexData((a.dataLoadedOffset-n)/4),n=a.dataLoadedOffset,t=u)}Kn.uploadTexData((a.dataLoadedOffset-n)/4)})().then(s),a}async function dr(t){let e;if(console.log(`Loading "${t.label}" (${t.loadType})...`),"stream"===t.loadType)e=await cr(t.downloadPath);else if("fetch"===t.loadType){e=new Ln,Kn.initScene(e);const n=await fetch(t.downloadPath);e.load(await n.arrayBuffer()),e.dataLoadedOffset=4*e.nNodes,Kn.uploadTexData(e.nNodes),e.renderPreferences.maxIterations=250}else"preloaded"===t.loadType&&(e=new Ln,Kn.initScene(e),t.getScene(e),e.originalNodeLength=e.nodes.length,e.dataLoadedOffset=4*e.nNodes,e.initialized=!0,Kn.uploadTexData(e.nNodes),e.renderPreferences.maxIterations=250);return void 0!==e.renderPreferences.renderMode&&or(e.renderPreferences.renderMode),e.renderPreferences.maxIterations&&sr(e.renderPreferences.maxIterations),e.renderPreferences.moveSpeed&&ir(e.renderPreferences.moveSpeed),e.renderPreferences.spawnPosition&&(Wn.position=e.renderPreferences.spawnPosition),console.log("Loaded!"),console.log(`Levels: ${e.nLevels}, nodes: ${e.nNodes}`),console.log(`Bbox:\n\t[${e.bboxStart}]\n\t[${e.bboxEnd}]\n\t(center: [${e.bboxCenter}])`),e}async function hr(){if(0===Yn.length)throw new Error("No scenes available!");const t=document.getElementById("sceneSelector"),e=parseInt(t.options[t.selectedIndex].value)||0;Kn.deleteNodesTexture();const n=(null==jn?void 0:jn.bboxCenter)||o.create();Kn.createNodesTexture(),console.log(e,Yn),jn=await dr(Yn[e]),ar(jn.nLevels),(o.dist(n,jn.bboxCenter)>.001||jn.renderPreferences.spawnPosition)&&(jn.renderPreferences.spawnPosition||Wn.position.set(jn.bboxEnd),Wn.target.set(jn.bboxCenter),jn.renderPreferences.moveSpeed||ir(.01*o.distance(jn.bboxStart,jn.bboxEnd))),Wn.updateMatrices(),Hn.init()}function fr(){Date.now()>Qn+1e3&&(Qn=Date.now(),document.title=`DAGger - ${Jn} FPS`,tr=Jn,Jn=0),Jn++;const t=.001*(Date.now()-er);er=Date.now(),(Hn.update(t)||nr)&&(nr=!1,Kn.state.pathTraceFrame=0),Kn.state.renderMode===qn.PATH_TRACING?ur.style.width=100*Kn.state.pathTraceFrame/64+"%":ur.style.width="0%",Kn.render(),requestAnimationFrame(fr)}Zn.loadSelectedScene=hr.bind(void 0),window.addEventListener("load",(async function(){$n=document.querySelector("#glCanvas");const t=$n.getContext("webgl2");if(Kn=new Gn(Wn,$n),rr(Kn.state.renderScale),null===t)return void alert("Unable to initialize WebGL. Your browser or machine may not support it.");console.log(t.getParameter(t.VERSION),t.getParameter(t.SHADING_LANGUAGE_VERSION),t.getParameter(t.VENDOR)),console.log("Supported extensions:",t.getSupportedExtensions());const e=t.getParameter(t.MAX_3D_TEXTURE_SIZE),n=Math.floor(Math.pow(e,3)/5);if(console.log(`Max 3D tex = ${e}. Max avg. nodes ~= ${n} = ${Math.round(n/1e6)} MNodes`),!t.getExtension("EXT_color_buffer_float"))return console.error("The the EXT_color_buffer_float extension is not available - some features might not work"),void window.setUseBeamOptimization(!1,!0);t.clear(t.COLOR_BUFFER_BIT),Yn.push(...await zn.getGeneratedSceneList());const r=document.querySelector("#sceneSelector"),a=(t,e)=>{const n=document.createElement("option");n.value=""+e,n.innerText=t.label,r.appendChild(n)};Yn.forEach(a),zn.getPrebuiltSceneList().then(t=>{Yn.push(...t),r.innerHTML="",Yn.forEach(a)}),Hn=new kn(Wn,1),await hr(),Hn.init(),await Kn.initShaders(),Kn.initialize(),Kn.initUniforms(),Kn.setInitialUniforms(Kn.viewerUniformDict),t.disable(t.DEPTH_TEST),$n.tabIndex=0,$n.addEventListener("keydown",Hn.onKeyDown.bind(Hn)),$n.addEventListener("keyup",Hn.onKeyUp.bind(Hn)),$n.addEventListener("mousedown",Hn.onMouseDown.bind(Hn)),$n.addEventListener("mouseup",Hn.onMouseUp.bind(Hn)),$n.addEventListener("mousemove",Hn.onMouseMove.bind(Hn)),$n.addEventListener("wheel",Hn.onMouseWheel.bind(Hn)),$n.oncontextmenu=()=>!1,$n.addEventListener("touchstart",Hn.onTouchStart.bind(Hn)),$n.addEventListener("touchend",Hn.onTouchEnd.bind(Hn)),$n.addEventListener("touchmove",Hn.onTouchMove.bind(Hn)),$n.addEventListener("keydown",t=>{"1"===t.key?ar(Kn.state.drawLevel-1):"2"===t.key&&ar(Kn.state.drawLevel+1)}),setTimeout(()=>{tr<15?rr(.25):tr<30?rr(.5):tr<45&&rr(.75)},2500),fr()}))}});
//# sourceMappingURL=bundle.js.map